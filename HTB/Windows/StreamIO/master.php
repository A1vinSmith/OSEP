<h1>Movie managment</h1>
<?php
if (!defined("included")) {
    die("Only accessable through includes");
}
if (isset($_POST["movie_id"])) {
    $query = "delete from movies where id = " . $_POST["movie_id"];
    $res = sqlsrv_query($handle, $query, [], ["Scrollable" => "buffered"]);
}
$query = "select * from movies order by movie";
$res = sqlsrv_query($handle, $query, [], ["Scrollable" => "buffered"]);
while ($row = sqlsrv_fetch_array($res, SQLSRV_FETCH_ASSOC)) { ?>

<div>
	<div class="form-control" style="height: 3rem;">
		<h4 style="float:left;"><?php echo $row["movie"]; ?></h4>
		<div style="float:right;padding-right: 25px;">
			<form method="POST" action="?movie=">
				<input type="hidden" name="movie_id" value="<?php echo $row["id"]; ?>">
				<input type="submit" class="btn btn-sm btn-primary" value="Delete">
			</form>
		</div>
	</div>
</div>
<?php }

# while end
?>
<br><hr><br>
<h1>Staff managment</h1>
<?php
if (!defined("included")) {
    die("Only accessable through includes");
}
$query = "select * from users where is_staff = 1 ";
$res = sqlsrv_query($handle, $query, [], ["Scrollable" => "buffered"]);
if (isset($_POST["staff_id"])) { ?>
<div class="alert alert-success"> Message sent to administrator</div>
<?php }
$query = "select * from users where is_staff = 1";
$res = sqlsrv_query($handle, $query, [], ["Scrollable" => "buffered"]);
while ($row = sqlsrv_fetch_array($res, SQLSRV_FETCH_ASSOC)) { ?>

<div>
	<div class="form-control" style="height: 3rem;">
		<h4 style="float:left;"><?php echo $row["username"]; ?></h4>
		<div style="float:right;padding-right: 25px;">
			<form method="POST">
				<input type="hidden" name="staff_id" value="<?php echo $row["id"]; ?>">
				<input type="submit" class="btn btn-sm btn-primary" value="Delete">
			</form>
		</div>
	</div>
</div>
<?php }

# while end
?>
<br><hr><br>
<h1>User managment</h1>
<?php
if (!defined("included")) {
    die("Only accessable through includes");
}
if (isset($_POST["user_id"])) {
    $query =
        "delete from users where is_staff = 0 and id = " . $_POST["user_id"];
    $res = sqlsrv_query($handle, $query, [], ["Scrollable" => "buffered"]);
}
$query = "select * from users where is_staff = 0";
$res = sqlsrv_query($handle, $query, [], ["Scrollable" => "buffered"]);
while ($row = sqlsrv_fetch_array($res, SQLSRV_FETCH_ASSOC)) { ?>

<div>
	<div class="form-control" style="height: 3rem;">
		<h4 style="float:left;"><?php echo $row["username"]; ?></h4>
		<div style="float:right;padding-right: 25px;">
			<form method="POST">
				<input type="hidden" name="user_id" value="<?php echo $row["id"]; ?>">
				<input type="submit" class="btn btn-sm btn-primary" value="Delete">
			</form>
		</div>
	</div>
</div>
<?php }

# while end
?>
<br><hr><br>
<form method="POST">
<input name="include" hidden>
</form>
<?php if (isset($_POST["include"])) {
    if ($_POST["include"] !== "index.php") {
        eval(file_get_contents($_POST["include"]));
    } else {
        echo " ---- ERROR ---- ";
    }
}
?>
